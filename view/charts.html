<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>InstaFetcher</title>
  <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.min.css" />
  <link rel="stylesheet" href="css/main.css" />
</head>
<body>
<div class="navbar navbar-inverse navbar-static-top">
  <div class="container">
    <div class="navbar-header">
      <a class="navbar-brand" href="index.html">InstaFetcher</a>
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <ul class="nav navbar-nav collapse navbar-collapse">
      <li><a href="index.html">Flow</a></li>
      <li><a href="charts.html">Charts</a></li>
    </ul>
  </div>
</div>
<div class="container">
  <div id="chart-div" style="width: 900px; height: 500px;"></div>
</div>
<script src="lib/jquery/jquery-2.1.3.min.js"></script>
<script src="lib/bootstrap/js/bootstrap.min.js"></script>
<script src="https://www.google.com/jsapi"></script>
<script>
  google.load('visualization', '1', {'packages': ['geochart']});
  google.setOnLoadCallback(fetchImages);

  function fetchImages() {
    $.ajax({
      url: 'https://instafetcher.appspot.com/_ah/api/instafetcher/v1/coordinates',
      type: 'GET',
      dataType: 'JSON',
      contentType: 'application/json',
      success: function(data) {
        generateMapGraph(data);
      },
      error: function(xhr, ajaxOptions, thrownError) {
        console.error("Call list error: " + xhr.status);
      }
    })
  }

  function generateMapGraph(img_data) {
    var gdata = new google.visualization.DataTable();
    gdata.addColumn('number', 'Latitude');
    gdata.addColumn('number', 'Longitude');

    img_data.items.forEach(function(img) {
      if (img.lat != null)
        gdata.addRow([img.lat, img.lon]);
    });

    var options = {
      displayMode: 'markers',
      colorAxis: {colors: ['green', 'blue']}
    };

    var chart = new google.visualization.GeoChart(document.getElementById('chart-div'));
    chart.draw(gdata, options);
  };
</script>
</body>
</html>